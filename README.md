# Лабораторная работа №4  
## Средства постэксплуатации. Анализ Command & Control фреймворка

---

### Выполнили:
- студент 5 курса группы **21-КАС-1**  
  **Гофман Никита Антонович**
- студент 5 курса группы **21-КАС-1**  
  **Аксенов Владислав Вячеславович**

---

## Цель работы

Изучить принципы работы фреймворков постэксплуатации (Command & Control), разобрать архитектуру C2-систем, получить практические навыки развёртывания сервера управления, создания полезной нагрузки, получения Beacon-сессии и анализа возможностей злоумышленника после компрометации целевой системы.

---

## Используемый фреймворк

В рамках лабораторной работы был выбран фреймворк:

**Cobalt Strike 4.9**

Причины выбора:
- широкое распространение в реальных атаках;
- развитый функционал постэксплуатации;
- наличие Beacon-агента;
- поддержка pivoting, credential harvesting и lateral movement.

---

## Среда выполнения

### Сервер C2:
- ОС: **Ubuntu**
- IP-адрес: `192.168.3.25`
- Назначение: запуск Team Server Cobalt Strike

### Клиент C2:
- ОС: **Ubuntu**
- Назначение: запуск графического клиента Cobalt Strike

### Целевая система:
- ОС: **Windows 10**
- Назначение: запуск сгенерированной полезной нагрузки (payload)

Все действия выполнялись **в виртуальной лабораторной среде**, виртуальные машины находились в одной локальной сети.

---

## 1. Запуск сервера Cobalt Strike

На виртуальной машине Ubuntu был запущен Team Server Cobalt Strike:

**Скриншот:**
`screenshots/1.jpg`

---

Team Server запускается в консольном режиме и ожидает подключения клиента управления.

**Скриншот:**
`screenshots/01_server_start.png`

---

## 2. Запуск клиентского GUI Cobalt Strike

На машине с Ubuntu был запущен клиент Cobalt Strike:

```bash
./cobaltstrike-client.sh
```

После указания IP-адреса сервера и пароля открывается графический интерфейс управления.

**Скриншот:**
`screenshots/02_client_gui.png`

---

## 3. Создание Listener (HTTP)

В интерфейсе Cobalt Strike был создан стандартный HTTP Listener.

Параметры listener’а:

* Тип: HTTP
* Порт: 80
* Beacon interval: стандартный

Listener используется для приёма Beacon-сессий от заражённых хостов.

**Скриншот:**
`screenshots/03_listener_http.png`

---

## 4. Генерация полезной нагрузки (Payload)

Была сгенерирована полезная нагрузка типа:

**Windows Stager Payload**

### Отличие типов payload:

* **Windows Stager Payload** — минимальный загрузчик, который после запуска скачивает основной Beacon с сервера.
* **Windows Stageless Payload** — Beacon целиком встроен в файл.
* **HTML Application / MS Office Macro** — используются в фишинговых атаках.
* **Stageless Generate All Payloads** — генерация всех вариантов.

**Скриншот:**
`screenshots/04_payload_windows_stager.png`

---

## 5. Получение Beacon-сессии

После запуска payload на Windows 10 была успешно получена Beacon-сессия, которая отобразилась в интерфейсе Cobalt Strike.

**Скриншот:**
`screenshots/05_beacon_session.png`

---

## 6. Работа с Beacon через CLI

После получения Beacon оператор получает доступ к CLI-интерфейсу управления агентом.

Пример выполнения команд:

```text
beacon> shell
C:\Users\User> whoami
C:\Users\User> systeminfo
```

Команда `systeminfo` позволяет определить версию ОС, архитектуру и информацию о системе.

**Скриншот:**
`screenshots/06_beacon_cli_shell_systeminfo.png`

---

## 7. Работа с процессами

Команда `ps` позволяет получить список процессов целевой системы.

Оператор может:

* завершать процессы;
* внедрять Beacon;
* внедрять shellcode;
* запускать процессы от имени других пользователей.

**Скриншот:**
`screenshots/07_process_list.png`

---

## 8. Инжект Beacon в процесс

Beacon может быть внедрён в легитимный процесс (например, `explorer.exe`) для повышения устойчивости и маскировки.

Команда:

```text
inject <pid>
```

**Скриншот:**
`screenshots/08_process_injection.png`

---

## 9. Explore / Context Menu Beacon

Через контекстное меню Beacon доступны функции:

* Desktop (VNC)
* File Browser
* Process List
* Net View
* Port Scan
* Screenshot
* Browser Pivot

**Скриншот:**
`screenshots/09_explore_menu.png`

---

## 10. Pivoting и SOCKS Proxy

Cobalt Strike позволяет развернуть SOCKS-прокси через Beacon:

```text
beacon> socks 1080
```

Это позволяет проксировать трафик во внутреннюю сеть жертвы и использовать `proxychains`.

**Скриншот:**
`screenshots/10_socks_pivot.png`

---

## Вывод

В ходе выполнения лабораторной работы были изучены принципы работы фреймворков постэксплуатации и архитектура C2-систем. Был выполнен развёртывание сервера и клиента Cobalt Strike на Ubuntu, создание listener’а, генерация полезной нагрузки для Windows 10 и получение Beacon-сессии.

В процессе работы были рассмотрены основные возможности злоумышленника после компрометации системы: выполнение команд, работа с процессами, внедрение кода, организация pivoting и проксирование трафика. Лабораторная работа позволила на практике понять типовой сценарий работы C2-фреймворков и действия атакующего на этапе постэксплуатации.

