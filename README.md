# Лабораторная работа №4

## Средства постэксплуатации. Анализ Command & Control фреймворка

---

### Выполнили:

* студент 5 курса группы **21-КАС-1**
  **Гофман Никита Антонович**
* студент 5 курса группы **21-КАС-1**
  **Аксенов Владислав Вячеславович**

---

## Цель работы

Изучить принципы работы фреймворков постэксплуатации (Command & Control), разобрать архитектуру C2-систем, получить практические навыки развёртывания сервера управления, создания полезной нагрузки, получения Beacon-сессии и анализа возможностей злоумышленника после компрометации целевой системы.

---

## Используемый фреймворк

В рамках лабораторной работы был выбран фреймворк:

**Cobalt Strike 4.9**

Причины выбора:

* широкое распространение в реальных атаках;
* развитый функционал постэксплуатации;
* наличие Beacon-агента;
* поддержка pivoting, credential harvesting и lateral movement.

---

## Среда выполнения

### Сервер C2:

* ОС: **Ubuntu**
* IP-адрес: `192.168.3.25`

### Клиент:

* ОС: **Windows 10**
* Используется для запуска payload
### Целевая система:

* ОС: **Windows 10**
* В одной локальной сети с C2-сервером

Все действия выполнялись **в виртуальной лабораторной среде**.

---

## 1. Запуск сервера Cobalt Strike

На виртуальной машине Ubuntu был запущен Team Server и Client:

**Скриншот:**
`1.jpg`

Сервер запускается в консольном режиме и ожидает подключения клиента.

**Скриншот:**
`1.jpg`

---

## 2. Запуск клиентского GUI

На машине с Windows был запущен клиент Cobalt Strike:

```bash
./cobaltstrike-client.sh
```

После подключения к серверу отображается графический интерфейс управления.

**Скриншот:**
`02_client_gui.png`

---

## 3. Создание Listener (HTTP)

В интерфейсе Cobalt Strike был создан стандартный HTTP Listener.

Параметры:

* Тип: HTTP
* Порт: 80
* Beacon Interval: стандартный

Listener используется для приёма Beacon-сессий от заражённых хостов.

**Скриншот:**
`03_listener_http.png`

---

## 4. Генерация полезной нагрузки (Payload)

Был создан payload типа:

**Windows Stager Payload**

### Отличие типов payload:

* **Windows Stager Payload** — минимальный загрузчик, который после запуска скачивает основной Beacon с сервера.
* **Windows Stageless Payload** — содержит Beacon целиком, больший размер.
* **HTML Application / Office Macro** — используются для фишинга.
* **Stageless Generate All Payloads** — массовая генерация.

Для лабораторной работы выбран **Windows Stager Payload** как наиболее показательный.

**Скриншот:**
`04_payload_windows_stager.png`

---

## 5. Получение Beacon-сессии

После запуска payload на Windows 10 была успешно получена Beacon-сессия.

Beacon подключился к серверу по HTTP и появился в интерфейсе Cobalt Strike.

**Скриншот:**
`05_beacon_session.png`

---

## 6. Работа с Beacon через CLI

После получения Beacon оператор получает доступ к CLI-интерфейсу управления агентом.

### Пример получения оболочки:

```text
beacon> shell
C:\Users\User> whoami
C:\Users\User> systeminfo
```

Команда `systeminfo` позволяет определить:

* версию ОС,
* архитектуру,
* имя хоста,
* доменную принадлежность.

**Скриншот:**
`06_beacon_cli_shell_systeminfo.png`

### Основные возможности CLI:

* выполнение команд ОС;
* управление файлами;
* работа с процессами;
* повышение привилегий;
* сбор учетных данных;
* сетевое сканирование.

---

## 7. Работа с процессами

Команда `ps` позволяет получить список процессов целевой системы.

Доступные действия:

* завершение процесса;
* внедрение Beacon;
* внедрение shellcode;
* запуск процессов от имени других пользователей.

**Скриншот:**
`07_process_list.png`

---

## 8. Инжект Beacon в процесс

Оператор может внедрить Beacon в легитимный процесс (например, `explorer.exe`) для повышения устойчивости и маскировки.

Используется команда:

```text
inject <pid>
```

**Скриншот:**
`08_process_injection.png`

---

## 9. Explore / Context Menu Beacon

При нажатии ПКМ по Beacon доступны функции:

* **Desktop (VNC)** — удалённый доступ к рабочему столу
* **File Browser** — просмотр файловой системы
* **Process List** — управление процессами
* **Net View** — сетевое окружение
* **Port Scan** — сканирование портов
* **Screenshot** — снимок экрана
* **Browser Pivot** — pivot через браузер

**Скриншот:**
`09_explore_menu.png`

---

## 10. Pivoting и SOCKS Proxy

Cobalt Strike позволяет развернуть SOCKS-сервер:

```text
beacon> socks 1080
```

Это позволяет:

* проксировать трафик во внутреннюю сеть;
* использовать `proxychains`;
* проводить сканирование и атаки изнутри сети жертвы.

**Скриншот:**
`10_socks_pivot.png`

---

## Вывод

В ходе выполнения лабораторной работы были изучены и практически реализованы основные этапы работы фреймворка постэксплуатации Cobalt Strike. Был выполнен развёртывание C2-сервера, запуск клиентского интерфейса, создание listener’а, генерация полезной нагрузки и получение Beacon-сессии на целевой системе.

В рамках работы были рассмотрены возможности управления системой жертвы через CLI, работа с процессами, повышение привилегий, внедрение кода, организация pivoting и проксирование трафика. Лабораторная работа позволила на практике понять архитектуру C2-фреймворков и действия злоумышленника после успешной компрометации системы.

---

Если хочешь — могу:

* проверить **соответствие методичке**,
* помочь **подготовить защиту устно**,
* или **оформить Lab #5** в том же стиле.
